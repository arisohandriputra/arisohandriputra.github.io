<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Pastebin | Ari Sohandri Putra</title>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/php/php.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>

<style type="text/css">
body,td,th { font-family: Times New Roman, Times, serif; }
a:link { color:#0000FF; }
a:visited { color:#0000FF; }
a:hover { color:#FF0000; }
a:active { color:#0000FF; }

.CodeMirror {
  border:1px solid #000;
  height:400px;
  font-family: monospace;
  font-size: 13px;
}
</style>
</head>

<body>

<table width="100%" border="0">
<tr>
<td>

<p><b><i>Simple Pastebin</i></b></p>
<hr>

Mode:
<select id="mode">
  <option value="plain">Plain Text</option>
  <option value="javascript">JavaScript</option>
  <option value="php">PHP</option>
  <option value="xml">HTML/XML</option>
  <option value="css">CSS</option>
</select>

Password (optional):
<input type="password" id="pass">

<input type="button" value="Save Paste" onclick="savePaste()">

<br><br>

<div id="editor"></div>

<div id="result"></div>

<hr>
<a href="/">Back to Home</a>

</td>
</tr>
</table>

<script>
const API="https://domainkamu.profreehost.com/api/api.php";

var editor = CodeMirror(document.getElementById("editor"), {
    lineNumbers:true,
    mode:"plain"
});

document.getElementById("mode").onchange=function(){
    editor.setOption("mode",this.value);
};

function savePaste(){
    var fd=new FormData();
    fd.append("text",editor.getValue());
    fd.append("pass",document.getElementById("pass").value);
    fd.append("mode",document.getElementById("mode").value);

    fetch(API+"?a=create",{method:"POST",body:fd})
    .then(r=>r.json())
    .then(d=>{
        var url=location.origin+"/paste/?id="+d.id;
        var raw=API+"?a=raw&id="+d.id;

        document.getElementById("result").innerHTML=
        "<br>Link: <a href='"+url+"'>"+url+"</a><br>"+
        "Raw: <a href='"+raw+"' target='_blank'>"+raw+"</a>";
    });
}

function loadPaste(id){
    var pass=prompt("Password jika ada:");
    var fd=new FormData();
    fd.append("pass",pass);

    fetch(API+"?a=get&id="+id,{method:"POST",body:fd})
    .then(r=>r.json())
    .then(d=>{
        if(d.ok){
            editor.setValue(d.text);
            editor.setOption("mode",d.mode);
        }else if(d.e=="lock"){
            alert("Password salah");
        }else{
            alert("Paste tidak ditemukan");
        }
    });
}

var p=new URLSearchParams(location.search);
if(p.get("id")) loadPaste(p.get("id"));
</script>

</body>
</html>
